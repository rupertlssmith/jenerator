<!-- Defines the content catalogue for The Cookery Book website. -->
<CatalogueDefinition xmlns="http://thesett.com/catalogue-def-0.2"
                     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                     xsi:schemaLocation="http://thesett.com/catalogue-def-0.2">
    
    <Package name="scot.mygov.pp.model"/>

    <Decimal name="percent" precision="6" scale="4" from="0" to="100"/>
    <IntegerRange name="intPercent" from="0" to="100"/>
    <IntegerRange name="positive" from="0"/>
    <Decimal name="money" precision="19" scale="4" from="0"/>
    <Decimal name="employees" precision="8" scale="2" from="0"/>
    <Decimal name="fractionOfOne" precision="5" scale="4" from="0" to="1"/>
    <StringPattern name="email" regexp="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}$"/>
    <StringPattern name="telephone" regexp="^[0-9 ]+$"/>
    
    <EnumerationDef name="dashboardType"/>

    <!-- For providing references to records (also used for simple summary queries) -->
    <ViewDef name="namedRef">
        <String name="name"/>
    </ViewDef>
   
    <EntityDef name="dashboard">
        <String name="title"/>
        <Component name="service" type="service"/>
    </EntityDef>

    <!-- The date and time dimensions. -->
    <DimensionDef name="date_dimension">
        <Date name="date"/>
        <String name="full_date_description"/>
        <Integer name="day_of_week"/>
        <String name="weekday_name"/>
        <Integer name="day_number_in_epoch"/>
        <Integer name="week_number_in_epoch"/>
        <Integer name="month_number_in_epoch"/>
        <Integer name="day_number_in_calendar_month"/>
        <Integer name="day_number_in_calendar_year"/>
        <Boolean name="last_day_in_week_indicator"/>
        <Boolean name="last_day_in_month_indicator"/>
        <Integer name="calendar_week_ending_date"/>
        <Integer name="calendar_week_number_in_year"/>
        <String name="calendar_month_name"/>
        <Integer name="calendar_month_number_in_year"/>
        <String name="calendar_year_month"/>
        <String name="calendar_quarter"/>
        <String name="calendar_year_quarter"/>
        <Integer name="calendar_half_year"/>
        <Integer name="calendar_year"/>
        <Boolean name="weekday_indicator"/>
    </DimensionDef>
    
    <DimensionDef name="time_of_day_dimension">
        <Integer name="hour"/>
        <Integer name="minute"/>
        <Integer name="second"/>
    </DimensionDef>

    <!-- The service and organisation conformed dimensions. -->
    <DimensionDef name="service_dimension">
        <String name="name"/>
        <Real name="annual_cost" type="money"/>
    </DimensionDef>
    
    <DimensionDef name="organisation_dimension">
        <String name="name"/>
        <String name="sector"/>
        <String name="directorate"/>
        <Real name="total_employees"/>
    </DimensionDef>

    <DimensionDef name="channel_dimension">
        <String name="name"/>
    </DimensionDef>

    <!-- Fact table for transactions. -->
    <FactDef name="transaction_summary_fact">
        <Component name="date" type="date_dimension"/>
        <Component name="service" type="service_dimension"/>
        <Component name="organisation" type="organisation_dimension"/>

        <Integer name="num_completed"/>
        <Integer name="num_completed_online"/>
        <Integer name="num_started"/>
        <Real name="satisfaction_degree"/>
        <Real name="cost" type="money"/>
    </FactDef>

    <!-- Fact table for realtime online. -->
    <FactDef name="online_now_fact">
        <Component name="date" type="date_dimension"/>
        <Component name="service" type="service_dimension"/>
        <Component name="organisation" type="organisation_dimension"/>
        <Component name="time" type="time_of_day_dimension"/>

        <Integer name="num_online"/>
    </FactDef>
        
    <!-- Fact table for web analyitics summary. -->
    <DimensionDef name="source_dimension">
        <String name="source"/>
        <String name="search_term"/>
        <Boolean name="social_flag"/>
        <Boolean name="search_flag"/>

        <Integer name="entrances"/>
        <Integer name="bounces"/>
    </DimensionDef>
    
    <DimensionDef name="source_bridge_dimension">
        <Component name="source" type="source_dimension"/>
        <Boolean name="top_flag"/>        
    </DimensionDef>

    <FactDef name="web_analytics_summary_fact">
        <Component name="date" type="date_dimension"/>
        <Component name="service" type="service_dimension"/>
        <Component name="organisation" type="organisation_dimension"/>
        <Component name="source" type="source_bridge_dimension"/>

        <Integer name="num_visitors"/>
        <Integer name="page_views"/>
        <Integer name="new_visitors"/>
        <Integer name="returning_visitors"/>

        <Integer name="num_desktop"/>
        <Integer name="num_mobile"/>
        <Integer name="num_tablet"/>

        <Integer name="num_google_chrome"/>
        <Integer name="num_ie_gt_9"/>
        <Integer name="num_ie_lte_9"/>
        <Integer name="num_firefox"/>
        <Integer name="num_safari"/>
        <Integer name="num_other"/>
    </FactDef>

    <!-- === STARS data model. -->
    <!-- === Reference Data Types. === -->
    <EnumerationDef name="serviceType"/>
    <EnumerationDef name="audienceType"/>
    <EnumerationDef name="organisationType"/>
    <EnumerationDef name="sgDirectorateType"/>

    <!-- For recording common auditing fields against records. -->
    <ComponentDef name="base">
        <TimeStamp name="lastUpdated"/>
    </ComponentDef>
    
    <ViewDef name="baseRecord">
        <Component name="base" type="base"/>
    </ViewDef>
    
    <!-- For providing references to records (also used for simple summary queries) -->
    <ViewDef name="namedRef">
        <String name="name"/>
    </ViewDef>

    <ComponentDef name="address">
        <String name="country"/>
        <String name="street"/>
        <String name="city"/>
        <String name="province"/>
        <String name="postcode"/>
    </ComponentDef>

    <!-- === Principal Entity : Service === -->
    <EntityDef name="service">
        <Unique natural_key="true">
            <String name="name"/>
        </Unique>

        <View type="baseRecord"/>
        <View type="namedRef"/>
        
        <Component name="base" type="base"/>
        
        <Set name="organisations">
            <Component name="organisation" type="organisation"/>
        </Set>

        <Enumeration name="type" type="serviceType"/>
        <String name="description"/>
        <Set name="audience">
            <Enumeration name="audience" type="audienceType"/>
        </Set>
        <Real name="annualCost" type="money"/>
    </EntityDef>

    <!-- === Principal Entity : Organisation === -->
    <ComponentDef name="contact">
        <String name="firstName"/>
        <String name="lastName"/>
    </ComponentDef>
    
    <EntityDef name="organisation">
        <Unique natural_key="true">
            <String name="name"/>
        </Unique>

        <View type="namedRef"/>
        
        <Enumeration name="sector" type="organisationType"/>
        
        <String name="synposis"/>
        <Real name="totalEmployees" type="employees"/>
        <Real name="digitalEmployees" type="employees"/>
        
        <Enumeration name="directorate" type="sgDirectorateType"/>
        <Component name="sgContactName" type="contact"/>
        <Component name="boardContactName" type="contact"/>
        <String name="boardPosition"/>
        <String name="websiteURL"/>

        <Set name="services">
            <Component name="service" type="service"/>
        </Set>

        <Component name="address" type="address"/>
        <String name="fax"/>
        <String name="phone"/>
    </EntityDef>

    <!-- === Timestamps sync operations with other data sources. === -->
    <!--
    <EnumerationDef name="syncStateType"/>
    
    <EntityDef name="lastSyncTime">
        <Unique natural_key="true">
            <String name="source"/>
            <TimeStamp name="timestamp"/>
        </Unique>
        <Enumeration name="state" type="syncStateType"/>
    </EntityDef>
    -->
    
    <!-- === Security: Users and Roles. === -->
    <!--
    <EntityDef name="authUser">
        <Unique natural_key="true">
            <String name="username"/>
        </Unique>
        <String name="password"/>
        <Set name="roles">
            <Component name="role" type="role"/>
        </Set>
    </EntityDef>

    <EntityDef name="role">
        <Unique natural_key="true">
            <String name="name"/>
        </Unique>
        <Set name="permissions">
            <String name="permission"/>
        </Set>
    </EntityDef>
    -->

</CatalogueDefinition>
